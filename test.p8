pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
function _init()
    make_player()
    make_npcs()
    make_map()
    draw_map()

    game_over = false
    btnpress=0
    tick=0

    focus={}
    focus.x=p.x
    focus.y=p.y
    focus.dir=left
end

function _update()
    --tick increments every other frame 
    if (t()%2 ==0) tick+=1

    player_spin()
    interact_buttonp()
end

function _draw()
    cls()
    draw_map()

    draw_player()
    p_idle_anim()

    draw_npc(dylFish,8,3)
    npc_anim()

    print(focus.x)
    print(focus.y)
    print(mget(focus.x,focus.y))
end

function tile_check(x,y,flag)
    --check tile flag return tile flag bool
    return fget(mget(x,y),flag)
end

function make_player()
    p={}
    p.x=1
    p.y=1
    p.state=true
    p.sprite=1
end

function make_map()
    wall = 1
    npc = 2
end

function make_npcs()
    npc={ 130, 128, 160, 176, 144, 162 }

    --order of npcs appearing + first sprite #
    dog = 130 --save point dog
    yeFish = 128 --generic fish
    swFish = 160 --swedish fish
    mumKrew = 176 --mumblekrew
    dEel = 144 --deal eel
    dylFish = 162 -- dylan fish

end

function draw_map()
	mapx=flr(p.x/16)*16
	mapy=flr(p.y/16)*16
	camera(mapx*8,mapy*8)
	
	map(0,0,0,0,128,64)
end

function p_idle_anim()
    cur = t()
    -- if last time btn pressed - time game has been running is less than 2 seconds
    if (cur - btnpress > 2) then
        if(focus.dir=='left') then 
            if((tick%2) == 0) then
                p.sprite=17
            else
                p.sprite=33
            end
        else
            if((tick%2) == 0) then
                p.sprite=16
            else
                p.sprite=32
            end
        end
    end
end

function draw_npc(npcCode,x,y)
    if(x < p.x) then --face right 
        spr(npcCode,x*8,y*8,1,1,true)
        --add wall placeblock underneath
        mset(x,y,65)
    else
        --npc sprite at a location
        spr(npcCode,x*8,y*8)
        --add wall placeblock underneath
        mset(x,y,65)
    end
end

function npc_anim()
    if((tick%2) == 0) then
        dog=130
        yeFish=128
        swFish = 160 
        mumKrew = 176 
        dEel = 144 
        dylFish = 162
    else
        dog=131
        yeFish=129
        swFish=161
        mumKrew=177
        dEel=145
        dylFish=163
    end
end

function draw_player()
    spr(p.sprite,p.x*8,p.y*8)
end

function player_spin()
    --turning player sprite and store direction
    if(btn(⬅️)) then --left 
        p.sprite=2 
        focus.x = p.x-1
        focus.y = p.y 
        focus.dir = 'left'

        btnpress = t()
        move_player() 
    end 
    if(btn(➡️)) then --right
        p.sprite=3 
        focus.x = p.x+1
        focus.y = p.y  
        focus.dir = 'right'

        btnpress = t()
        move_player() 
    end
    if(btn(⬆️)) then --up
        p.sprite=4 
        focus.x = p.x
        focus.y = p.y-1 
        focus.dir = 'up'

        btnpress = t()
        move_player() 
    end
    if(btn(⬇️)) then --down
        p.sprite=5 
        focus.x = p.x
        focus.y = p.y+1
        focus.dir = 'down'

        btnpress = t() 
        move_player()
    end
end

function move_player()
    --wanted player pos = current player pos
    nx=p.x
    ny=p.y

    if(btnp(⬅️)) nx-=1
	if(btnp(➡️)) nx+=1
	if(btnp(⬆️)) ny-=1
    if(btnp(⬇️)) ny+=1

    if(tile_check(nx,ny,wall)) then
        --is wall flag
        --animate bumping sprite
        p.sprite=p.sprite+16
        --play sfx
     else   
         --player moved to desired pos
         p.x=nx    
         p.y=ny 
     end
end

function interact_buttonp()
    if(btnp(4)) then
        interact()
    end
end

function interact()
    --tile checks npc sprite
    if(tile_check(focus.x,focus.y,npc)) then
        --play npc dialogue and pass sprite variable
        rectfill(8*8,6*8,16*8,10*8,1)
    end
end

function npc_dialogue(npcNum)
    rectfill(8*8,6*8,16*8,10*8,1)
end

__gfx__
00000000000000000000000000000000000660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000006000000000000000000006066000060060000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000c6660066c00600600c660006666000006600000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000666600606666000066660600c66c000006600000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000606c0066666600006666660006600000c66c0000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000666000066c00600600c660000660000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000006006000066060000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000006600000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000d0000d000000000000000000000000000000060060000000000000000000000000000000000000000000000000000000000000000000000000000000000
0060000dd00006000000000000000000000660000006600000000000000000000000000000000000000000000000000000000000000000000000000000000000
0666c000000c66600066c006600c6600006066000006600000000000000000000000000000000000000000000000000000000000000000000000000000000000
006666d00d66660006066660066660600066660000c66c0000000000000000000000000000000000000000000000000000000000000000000000000000000000
00c6560000656c00066666600666666000c66c000066660000000000000000000000000000000000000000000000000000000000000000000000000000000000
00066600006660000066c006600c6600000660000066060000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000660000006600000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000006006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000d00d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00600d0000d00600066c00600600c660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0666c000000c66606666660000666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
006666d00d6666006866660000666686000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00c6560000656c00066c00600600c660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00066600006660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000066c00600600c660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000006666660000666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000006866660000666686000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000066c00600600c660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000110000000000000000000000077700000000000000000000000000000000000000000000000000000000000
00055550000000000000000000000000001000000110000000000090000000000777670000000aa0000000000000000000000000000000000000000000000000
00575555000000000000000000000000016100000000000000900000000000007777776000000aa0000000000000000000000000000000000000000000000000
00577555000000000000000000000000001000000000000000000000000110007677766000000000000000000000000000000000000000000000000000000000
0555555500000000000000000000000000000000000aa00000000000000110007777666000000000000000000000000000000000000000000000000000000000
1555555100000000000000000000000000000000000aa00000009000000000000776660000000000000000000000000000000000000000000000000000000000
01155551000000000000000000000000000000000000000000000000000000000066600000000000000000000000000000000000000000000000000000000000
00011110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003b30000000000b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003b300000b0003b300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003b300003b3003b300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003b30003b3003b300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003b30003b303b3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003b30003b303b3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003b3003b3003b3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003b30003b30003b300000000ff7fff9fff7ff7ff00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003b300003b3003b300000000ffff9fff9ffffff700000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003b300003b3003b3000000007f9fff7ffff7f9ff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003b30003b3003b300000000ffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003b3003b3003b3000000000ffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000003b3003b3003b3000000000ffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003b30003b3003b3000000000ffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003b30003b30003b300000000ffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000
00d00000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000ff40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d00000000d000000ff4000ffff40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0099900000000000fff4fff008ffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009c90000d99900000fffff000fffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00999900009c90000054054000540540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00009000009999000004004000040040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c00000000000000d000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000d00000d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c0ddd000000000000004440400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d8ddd0000ddd000d03333300d044404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0ddddddd0d55dd000303330400333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00dddddd0ddddddd00333b0003553304000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000dddd00dddddd0000000000333b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000dddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00d00000d0000000d000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d08800080d000000000000f00d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08e8888000880008d0eeeeff000000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0888888008e888800e0eee0000eeeeff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00880008088888800eeef0000e0eee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000880008000000000eeef000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d00000000c6000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c60d000066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
066000d0d00600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0006000000000c600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d0000c6000c606600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00c60660006600060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
006600060d0060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020200000000000000000000
0606060e00000000000000000000000006060000000000000000000000000000060606060000000000000000000000000606000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
